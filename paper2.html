<!doctype html>
<html lang="en">

<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>원준 > 프롬프트 구현</title>
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"
		integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
	<style>
		#chat_result {
			height: 400px;
			background-color: white;
			border: 1px solid #aaa;
			border-radius: 5px;
			margin: 0;
			padding: 10px;
			overflow-y: auto;
		}

		.chat {
			margin: 5px 0 5px 0;
		}

		.chat-right {
			text-align: end;
		}

		.chatgpt-left-dialog {
			display: inline-block;
			font-size: 12px;
			background-color: aquamarine;
			border-radius: 5px;
			padding: 9px;
			white-space: pre-wrap;
		}

		.chat-right-dialog {
			display: inline-block;
			font-size: 12px;
			background-color: yellow;
			border-radius: 5px;
			padding: 9px;
			white-space: pre-line;
		}

		#chat_dialog {
			font-size: 12px;
		}
	</style>
</head>

<body>
	<div class="container">
		<header class="border-bottom">
			<div style="margin-left:10px;">
				<a href="/"><i class="fa-solid fa-house"></i></a>
			</div>
			<h1>코드리뷰 학습환경</h1>
			<p>2023, "프로그래밍 학습을 위한 LLM 기반 코드 리뷰 학습 환경 개발"</p>
		</header>
		<main class="" style="margin:20px 0 0 0; padding:0;">
			<div class="row col-12">
				<!-- 왼쪽 메뉴: 문제 종류 -->
				<div class="col-2">
					<div class="accordion" id="accordionMenu">
						<div class="accordian-item">
							<h2 class="accordion-header">
								<button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
									data-bs-target="#collapseOne" aria-expanded="false" aria-controls="collapseOne">
									# 입출력
								</button>
							</h2>
							<div id="collapseOne" class="accordion-collapse collapse" data-bs-parent="#accordionMenu">
								<div class="accordion-body" style="margin:0; padding:0;">
									<ul class="list-group">
										<li class="list-group-item">item 1-1</li>
										<li class="list-group-item">item 1-2</li>
										<li class="list-group-item">item 1-3</li>
									</ul>
								</div>
							</div>
						</div>
						<div class="accordian-item">
							<h2 class="accordion-header">
								<button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
									data-bs-target="#collapseTwo" aria-expanded="false" aria-controls="collapseTwo">
									# 조건문
								</button>
							</h2>
							<div id="collapseTwo" class="accordion-collapse collapse" data-bs-parent="#accordionMenu">
								<div class="accordion-body" style="margin:0; padding:0;">
									<ul class="list-group">
										<li class="list-group-item">item 2-1</li>
										<li class="list-group-item">item 2-2</li>
										<li class="list-group-item">item 2-3</li>
									</ul>
								</div>
							</div>
						</div>
						<div class="accordian-item">
							<h2 class="accordion-header">
								<button class="accordion-button" type="button" data-bs-toggle="collapse"
									data-bs-target="#collapseThree" aria-expanded="true" aria-controls="collapseThree">
									# 반복문
								</button>
							</h2>
							<div id="collapseThree" class="accordion-collapse collapse show"
								data-bs-parent="#accordionMenu">
								<div class="accordion-body" style="margin:0; padding:0;">
									<ul class="list-group">
										<li class="list-group-item">1.자연수 n까지 출력하기</li>
										<li class="list-group-item">2.카운트다운</li>
										<li class="list-group-item">3.자연수 n까지 더하기</li>
										<li class="list-group-item">4.별의 개수</li>
										<li class="list-group-item">5.짝수의 합 구하기</li>
										<li class="list-group-item">6.패턴 출력하기</li>
									</ul>
								</div>
							</div>
						</div>
					</div>
				</div>
				<!-- 가운데: 코드작성 -->
				<div class="col-6">
					<p style="font-size:small;">
						짝수의 합 구하기 / 정수를 입력했을 때 해당 숫자까지 짝수의 합을 구한다.
					</p>
					<iframe id="iframe-python-editor" title="Python Editor" width="100%" height="400px"
						src="{{ domain }}/paper2-editor"></iframe>
					<div class="text-end">
						<div id="loading-feedback" class="spinner-border text-success pt-3" role="status"
							style="display:none;">
							<span class="visually-hidden">Loading...</span>
						</div>
						<button id="btn_feedback" class="btn btn-success" onclick="sendFeedback()">피드백 받기</button>
					</div>
				</div>
				<!-- 오른쪽: ChatGPT -->
				<div class="col-4">
					<p style="font-size:small;">
						<img src="/static/chatgpt-logo.png" style="height:15px; width:auto;">
						Chatbot 코멘트
					</p>
					<div id="chat_result">
						<div class="chat">
							<div class="chatgpt-left-dialog">Chatbot의 코멘트가 출력되는 창입니다. code에 대한 코멘트를 보고 싶다면, 코드 제출 후 피드백
								버튼을 눌러주세요.</div>
						</div>
					</div>
					<div class="input-group pt-1">
						<textarea id="chat_dialog" class="form-control" style="background-color:aliceblue;"></textarea>
						<button id="btn_send" class="btn btn-primary" onclick="sendDialog()" style="width:50px;">
							<span id="label-dialog"><i class="fa-regular fa-paper-plane"></i></span>
							<div id="loading-dialog" class="spinner-border text-light pt-3" role="status"
								style="display:none;">
								<span class="visually-hidden">Loading...</span>
							</div>
						</button>
					</div>
				</div>
			</div>
		</main>
		<footer class="border-top pb-5">
		</footer>
	</div>

	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"
		integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL"
		crossorigin="anonymous"></script>
	<script src="https://kit.fontawesome.com/eaa55c88d8.js" crossorigin="anonymous"></script>

	<script>
		const iframe_editor = document.querySelector('#iframe-python-editor');
		const btn_feedback = document.querySelector('#btn_feedback');
		const chat_dialog = document.querySelector('#chat_dialog');
		const chat_result = document.querySelector('#chat_result');
		const btn_send = document.querySelector('#btn_send');
		const loading_feedback = document.querySelector('#loading-feedback');
		const label_dialog = document.querySelector('#label-dialog');
		const loading_dialog = document.querySelector('#loading-dialog');

		async function sendFeedback() {
			let editor_sourcecode = iframe_editor.contentWindow.document.querySelector('#sourcecode').getPySrc();
			loading_feedback.style.display = 'inline-block';
			if (editor_sourcecode.length != 0) {
				// alert(editor_sourcecode)
				let d = {};
				d['dialog'] = editor_sourcecode;
				let dstr = JSON.stringify(d);
				fetch('{{ domain }}/paper2-feedback', {
					method: 'POST',
					headers: {
						'Content-Type': 'application/json'
					},
					body: dstr
				}).then(response => response.json())
					.then(data => {
						// console.log(`${data}`)
						/*
						  #----chatgtp 대화 내용---#
						  <div class="chat">
							<div class="chatgpt-left-dialog">${data}</div>
						  </div>
						  #----사용자 대화 내용---#
						  <div class="chat chat-right">
							<div class="chat-right-dialog">${data}</div>
						  </div>
						*/
						// alert(`${data}`)
						chat_result.innerHTML += `
          <div class="chat">
            <div class="chatgpt-left-dialog">${data}</div>
          </div>
        `;
						chat_result.scrollTop = chat_result.scrollHeight;
					})
					.catch(error => console.log(`에러발생 ${error}`))
					.finally(() => {
						loading_feedback.style.display = 'none';
					});
			}
		}

		async function sendDialog() {
			let dialog_str = chat_dialog.value;
			if (dialog_str.length != 0) {
				let d = {};
				d['dialog'] = dialog_str;
				let dstr = JSON.stringify(d);
				chat_dialog.value = '';
				chat_result.innerHTML += `
      <div class="chat chat-right">
        <div class="chat-right-dialog">${dialog_str}</div>
      </div>
    `;
				chat_result.scrollTop = chat_result.scrollHeight;
				label_dialog.style.display = 'none';
				loading_dialog.style.display = 'block';
				btn_send.disabled = true;
				fetch('{{ domain }}/paper2-dialog', {
					method: 'POST',
					headers: {
						'Content-Type': 'application/json'
					},
					body: dstr
				}).then(response => response.json())
					.then(data => {
						chat_result.innerHTML += `
          <div class="chat">
            <div class="chatgpt-left-dialog">${data}</div>
          </div>
        `;
						chat_result.scrollTop = chat_result.scrollHeight;
					})
					.catch(error => console.log(`에러발생 ${error}`))
					.finally(() => {
						label_dialog.style.display = 'block';
						loading_dialog.style.display = 'none';
						btn_send.disabled = false;
					});
			}
		}
	</script>


</body>

</html>